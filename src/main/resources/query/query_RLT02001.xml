<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="RLT02001">
	
	<!-- Result승인 리스트 조회 -->
	<select id="RLT0200101S" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap">
		select
			rowNumber as "rowNum"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','PROGRAMCD',programCD,null) as "programCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','ACTIVITYCD',activityCD,null) as "activityCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','RAGESPHERECD',rageSphereCD,null) as "rageSphereCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','OFFICECD',officeCD,null) as "officeCDName"
			<isPropertyAvailable property="grpID">
				<isNotEmpty property="grpID">
			, (case when (select dkmdtpcd from GEMP01MT where empID=t2.empID) != 'DK' then '' else (select empNm from GEMP01MT where empID=t2.empID) end) as "empNm"
				</isNotEmpty>
				<isEmpty property="grpID">
			, (select empNm from GEMP01MT where empID=t2.empID) as "empNm"
				</isEmpty>
			</isPropertyAvailable>
			, venueCD as "venueCD"
			, venueNm as "venueNm"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','VENUEGRADCD',venueGradCD,null) as "venueGradCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','SEGMENTCD',segmentCD,null) as "segmentCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','SUBSEGMENTCD',subSegmentCD,null) as "subSegmentCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','ADDRTPCD1',addrTpCD1,null) as "addrTpCD1Name"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','ADDRTPCD2',addrTpCD2,null) as "addrTpCD2Name"
			, planUnitAmt as "planPayAmt"
			, tpayAmt as "tpayAmt"
			, resultTQty as "resultTQty"
			, avgUnitAmt as "avgUnitAmt"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','RESULTTPCD',resultTpCD,null) as "resultTpCDName"
			, targetRate as "targetRate"
			, payRate as "payRate"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','EXCPAYTPCD',excPayTpCD,null) as "excPayTpCDName"
			, gsvRate as "gsvRate"
			, commt as "commt"
			, apprCommt as "apprCommt"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','APPRSTATECD',apprStateCD_emp,null) as "apprStateCDName_emp"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','APPRSTATECD',apprStateCD,null) as "apprStateCDName"
			, apprStateCD as "apprStateCD"
			, apprStateCD_emp as "apprStateCD_emp"
			, lapprLevelNo as "lapprLevelNo"
			, levelNo as "levelNo"
			, lastApprYN as "lastApprYN"
			, guidPayRate as "guidPayRate"
			, excPayTpCD as "excPayTpCD"
		from (
			select
				t.*
				, rank() over(
					order by
						rageSphereCD
						, officeCD
						, empID
						, venueCD
				) as rowNumber
				, floor((rank() over(
					order by
						rageSphereCD
						, officeCD
						, empID
						, venueCD
					)-1)/#displayNum#+1) as pageNum
			from (
				select
					b.programCD
					, b.activityCD
					, c.rageSphereCD
					, c.officeCD
					, b.empID
					, a.venueCD
					, venueNm
					, venueGradCD
					, segmentCD
					, subSegmentCD
					, addrTpCD1
					, addrTpCD2
					, b.tpayAmt
					, resultTQty
					, (
						case when resultTQty=0 then 0
						else round(b.tpayAmt / resultTQty)
						end
					) as avgUnitAmt
					, resultTpCD
					, targetRate
					, payRate
					, guidPayRate
					, excPayTpCD
					, b.gsvRate
					, b.commt
					, a.commt as apprCommt
					, b.apprStateCD
					, a.apprStateCD as apprStateCD_emp
					, b.lapprLevelNo
					, a.levelNo
					, (
						case when b.lapprLevelNo = a.levelNo then 'Y'
						else 'N'
						end
					) as lastApprYN
					, (
						case when payRate != guidPayRate then 'Y'
						else 'N'
						end
					) as payRate_YN
					, (
						case when excPayTpCD = 'YPAY' then 'Y'
						else 'N'
						end
					) as excPayTpCD_YN
					, (
						case when b.gsvRate > 10 then 'Y'
						else 'N'
						end
					) as gsvRate_YN
					, e.resultUnitAmt
					, e.planUnitAmt
				from GRLT07MT a
				inner join GRLT01MT b
					on a.eventYM = b.eventYM
					and a.venueCD = b.venueCD
					and a.diffNo = b.diffNo
				inner join GEMP01MT c
					on b.empID = c.empID
				inner join GVEN01MT d
					on a.venueCD = d.venueCD
				<!-- 
				inner join GPLN01MT e
					on a.eventYM = e.eventYM
					and a.venueCD = e.venueCD
				<isPropertyAvailable property="plnRltCompareYN">
					<isEqual property="plnRltCompareYN" compareValue="Y">
						and b.tpayAmt <![CDATA[<>]]> e.tpayAmt
					</isEqual>
					<isEqual property="plnRltCompareYN" compareValue="N">
						and b.tpayAmt = e.tpayAmt
					</isEqual>
				</isPropertyAvailable>
				 -->
				inner join 
				(
					select
						 eventYM
						,venueCD
						,resultUnitAmt
						,planUnitAmt
						,diffNo
					from
						(select
							 t1.eventYM
							,t1.venueCD
							,SUM(t1.resultUnitAmt*t1.resultQty) resultUnitAmt
							,SUM(t2.planUnitAmt*t1.resultQty) planUnitAmt
							,t1.diffNo
						from GRLT01DT t1 INNER JOIN gpln01dt t2
						on t1.eventYM = t2.eventYM
						and t1.venueCD = t2.venueCD
						and t1.prdCD = t2.prdCD
						where
							t1.eventYM = #eventYM#	
						group by t1.eventYM, t1.venueCD, t1.diffNo	
						)
				) e
				on a.eventYM = e.eventYM
				and a.venueCD = e.venueCD
				and a.diffNo = e.diffNo
				where
					a.eventYM = #eventYM#
					and a.empID = #empID#
					and a.diffNo = #diffNo#
					and a.apprTpID = #apprTpID#
					and b.programCD = 'G1'
					and a.apprStateCD in (
						select comCode
						from F_CODE
						where
							codediv='APPRSTATECD'
							and activeFlg = 'U'
							and useYN = 'Y'
							and attrib02 = 'MNG'
					)
					<isPropertyAvailable property="activityCD">
						<isNotEmpty prepend="and" property="activityCD">
							activityCD = #activityCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="venueGradCD">
						<isNotEmpty prepend="and" property="venueGradCD">
							venueGradCD = #venueGradCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="segmentCD">
						<isNotEmpty prepend="and" property="segmentCD">
							segmentCD = #segmentCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="subSegmentCD">
						<isNotEmpty prepend="and" property="subSegmentCD">
							subSegmentCD = #subSegmentCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="rageSphereCD">
						<isNotEmpty prepend="and" property="rageSphereCD">
							c.rageSphereCD = #rageSphereCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="officeCD">
						<isNotEmpty prepend="and" property="officeCD">
							c.officeCD = #officeCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="apprStateCD">
						<isNotEmpty prepend="and" property="apprStateCD">
							a.apprStateCD = #apprStateCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="dkmdTpCD">
						<isNotEmpty prepend="and" property="dkmdTpCD">
							b.dkmdTpCD = #dkmdTpCD#
						</isNotEmpty>
					</isPropertyAvailable>
					<isPropertyAvailable property="plnRltCompareYN">
						<isEqual property="plnRltCompareYN" compareValue="Y">
						and
							b.tpayAmt <![CDATA[<>]]> e.planUnitAmt
						</isEqual>
						<isEqual property="plnRltCompareYN" compareValue="N">
						and
							b.tpayAmt = e.planUnitAmt
						</isEqual>
					</isPropertyAvailable>
			) t
			where 1=1
				<isPropertyAvailable property="payRate_YN">
					<isNotEmpty prepend="and" property="payRate_YN">
						payRate_YN = #payRate_YN#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="excPayTpCD_YN">
					<isNotEmpty prepend="and" property="excPayTpCD_YN">
						excPayTpCD_YN = #excPayTpCD_YN#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="gsvRate_YN">
					<isNotEmpty prepend="and" property="gsvRate_YN">
						gsvRate_YN = #gsvRate_YN#
					</isNotEmpty>
				</isPropertyAvailable>
		) t2
		where 1=1
			<isPropertyAvailable property="pageNum">
				<isNotEmpty prepend="and" property="pageNum">
					pageNum = #pageNum#
				</isNotEmpty>
			</isPropertyAvailable>
	</select>
	
	<select id="RLT0200106S" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap">
		select
			count(*) as "totalCount"
		from (
			select
				b.programCD
				, b.activityCD
				, c.rageSphereCD
				, c.officeCD
				, b.empID
				, a.venueCD
				, venueNm
				, venueGradCD
				, segmentCD
				, subSegmentCD
				, addrTpCD1
				, addrTpCD2
				, b.tpayAmt
				, resultTQty
				, (
					case when resultTQty=0 then 0
					else round(b.tpayAmt / resultTQty)
					end
				) as avgUnitAmt
				, resultTpCD
				, targetRate
				, payRate
				, guidPayRate
				, excPayTpCD
				, b.gsvRate
				, b.commt
				, a.commt as apprCommt
				, b.apprStateCD
				, a.apprStateCD as apprStateCD_emp
				, b.lapprLevelNo
				, a.levelNo
				, (
					case when b.lapprLevelNo = a.levelNo then 'Y'
					else 'N'
					end
				) as lastApprYN
				, (
					case when payRate != guidPayRate then 'Y'
					else 'N'
					end
				) as payRate_YN
				, (
					case when excPayTpCD = 'YPAY' then 'Y'
					else 'N'
					end
				) as excPayTpCD_YN
				, (
					case when b.gsvRate > 10 then 'Y'
					else 'N'
					end
				) as gsvRate_YN
			from GRLT07MT a
			inner join GRLT01MT b
				on a.eventYM = b.eventYM
				and a.venueCD = b.venueCD
				and a.diffNo = b.diffNo
			inner join GEMP01MT c
				on b.empID = c.empID
			inner join GVEN01MT d
				on a.venueCD = d.venueCD
			<!-- 
			inner join GPLN01MT e
				on a.eventYM = e.eventYM
				and a.venueCD = e.venueCD
			<isPropertyAvailable property="plnRltCompareYN">
				<isEqual property="plnRltCompareYN" compareValue="Y">
					and b.tpayAmt <![CDATA[<>]]> e.tpayAmt
				</isEqual>
				<isEqual property="plnRltCompareYN" compareValue="N">
					and b.tpayAmt = e.tpayAmt
				</isEqual>
			</isPropertyAvailable>
			 -->
			inner join 
			(
				select
					 eventYM
					,venueCD
					,resultUnitAmt
					,planUnitAmt
					,diffNo
				from
					(select
						 t1.eventYM
						,t1.venueCD
						,SUM(t1.resultUnitAmt*t1.resultQty) resultUnitAmt
						,SUM(t2.planUnitAmt*t1.resultQty) planUnitAmt
						,t1.diffNo
					from GRLT01DT t1 INNER JOIN gpln01dt t2
					on t1.eventYM = t2.eventYM
					and t1.venueCD = t2.venueCD
					and t1.prdCD = t2.prdCD
					where
						t1.eventYM = #eventYM#	
					group by t1.eventYM, t1.venueCD, t1.diffNo	
					)
					<!-- 
				<isPropertyAvailable property="plnRltCompareYN">
					<isEqual property="plnRltCompareYN" compareValue="Y">
					where
						resultUnitAmt <![CDATA[<>]]> planUnitAmt
					</isEqual>
					<isEqual property="plnRltCompareYN" compareValue="N">
					where
						resultUnitAmt = planUnitAmt
					</isEqual>
				</isPropertyAvailable>
				-->
			) e
			on a.eventYM = e.eventYM
			and a.venueCD = e.venueCD
			and a.diffNo = e.diffNo
			where
				a.eventYM = #eventYM#
				and a.empID = #empID#
				and a.diffNo = #diffNo#
				and a.apprTpID = #apprTpID#
				and b.programCD = 'G1'
				and a.apprStateCD in (
					select comCode
					from F_CODE
					where
						codediv='APPRSTATECD'
						and activeFlg = 'U'
						and useYN = 'Y'
						and attrib02 = 'MNG'
				)
				<isPropertyAvailable property="activityCD">
					<isNotEmpty prepend="and" property="activityCD">
						activityCD = #activityCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="venueGradCD">
					<isNotEmpty prepend="and" property="venueGradCD">
						venueGradCD = #venueGradCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="segmentCD">
					<isNotEmpty prepend="and" property="segmentCD">
						segmentCD = #segmentCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="subSegmentCD">
					<isNotEmpty prepend="and" property="subSegmentCD">
						subSegmentCD = #subSegmentCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="rageSphereCD">
					<isNotEmpty prepend="and" property="rageSphereCD">
						c.rageSphereCD = #rageSphereCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD">
					<isNotEmpty prepend="and" property="officeCD">
						c.officeCD = #officeCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="apprStateCD">
					<isNotEmpty prepend="and" property="apprStateCD">
						a.apprStateCD = #apprStateCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="dkmdTpCD">
					<isNotEmpty prepend="and" property="dkmdTpCD">
						b.dkmdTpCD = #dkmdTpCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="plnRltCompareYN">
					<isEqual property="plnRltCompareYN" compareValue="Y">
					and
						b.tpayAmt <![CDATA[<>]]> e.planUnitAmt
					</isEqual>
					<isEqual property="plnRltCompareYN" compareValue="N">
					and
						b.tpayAmt = e.planUnitAmt
					</isEqual>
				</isPropertyAvailable>
		) t
		where 1=1
			<isPropertyAvailable property="payRate_YN">
				<isNotEmpty prepend="and" property="payRate_YN">
					payRate_YN = #payRate_YN#
				</isNotEmpty>
			</isPropertyAvailable>
			<isPropertyAvailable property="excPayTpCD_YN">
				<isNotEmpty prepend="and" property="excPayTpCD_YN">
					excPayTpCD_YN = #excPayTpCD_YN#
				</isNotEmpty>
			</isPropertyAvailable>
			<isPropertyAvailable property="gsvRate_YN">
				<isNotEmpty prepend="and" property="gsvRate_YN">
					gsvRate_YN = #gsvRate_YN#
				</isNotEmpty>
			</isPropertyAvailable>
	</select>
	
	<!-- 상위승인자 정보 -->
	<select id="RLT0200102S" parameterClass="com.kia.rlt.model.GRLT01MT" resultClass="java.util.LinkedHashMap">
		select
			levelNo as "levelNo"
			, a.empID as "empID"
			, empNm as "empNm"
			, emailAddr as "emailAddr"
		from GRLT07MT a
		inner join GEMP01MT b
			on a.empID = b.empID
		where
			a.eventYM = #eventYM#
			and a.venueCD = #venueCD#
			and a.diffNo = #diffNo#
			and a.apprTpID = #apprTpID#
			and a.levelNo = #levelNo#+1
	</select>
	
	<!-- Result정보 승인상태 갱신 -->
	<update id="RLT0200101U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GRLT01MT
		set
			apprStateCD = #apprStateCD#
			, verifyStateCD = #verifyStateCD#
			, chgID = #userID#
			, chgDate = sysdate
		where
			eventYM = #eventYM#
			and venueCD = #venueCD#
			and diffNo = #diffNo#
	</update>
	
	<!-- Result승인정보 승인처리 -->
	<update id="RLT0200102U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GRLT07MT
		set
			apprStateCD = '50'
			, commt = #apprCommt#
			, apprDate = sysdate
			, chgID = #userID#
			, chgDate = sysdate
		where
			eventYM = #eventYM#
			and venueCD = #venueCD#
			and diffNo = #diffNo#
			and apprTpID = #apprTpID#
			and levelNo = #levelNo#
	</update>
	
	<!-- Result승인정보 상위자 승인요청처리 -->
	<update id="RLT0200103U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GRLT07MT
		set
			apprStateCD = '20'
			, chgID = #userID#
			, chgDate = sysdate
		where
			eventYM = #eventYM#
			and venueCD = #venueCD#
			and diffNo = #diffNo#
			and apprTpID = #apprTpID#
			and levelNo = #levelNo#+1
	</update>
	
	<!-- 최종승인시 메일보낼 하위승인자들 정보(자신제외) -->
	<select id="RLT0200103S" parameterClass="com.kia.rlt.model.GRLT01MT" resultClass="java.util.LinkedHashMap">
		select
			empID as "empID"
			, max(empNm) as "empNm"
			, max(emailAddr) as "emailAddr"
		from (
			select
				b.empID
				, empNm
				, emailAddr
			from GRLT01MT a
			inner join GRLT07MT b
				on a.eventYM = b.eventYM
				and a.venueCD = b.venueCD
				and a.diffNo = b.diffNo
			inner join GEMP01MT c
				on b.empID = c.empID
			where
				a.eventYM = #eventYM#
				and a.venueCD in
	    		<iterate property="venueCDs" open="(" close=")" conjunction=",">
					#venueCDs[]#
		     	</iterate>
		     	and a.diffNo = #diffNo#
		     	and b.apprTpID = #apprTpID#
				and b.empID != #empID#
		)
		group by empID
	</select>
	
	<!-- 반려시 메일보낼 하위승인자들 정보(상태가 비어있거나, 승인요청인 사람 제외) -->
	<select id="RLT0200104S" parameterClass="com.kia.rlt.model.GRLT01MT" resultClass="java.util.LinkedHashMap">
		select
			empID as "empID"
			, max(empNm) as "empNm"
			, max(emailAddr) as "emailAddr"
		from (
			select
				b.empID
				, empNm
				, emailAddr
				, b.apprStateCD
			from GRLT01MT a
			inner join GRLT07MT b
				on a.eventYM = b.eventYM
				and a.venueCD = b.venueCD
				and a.diffNo = b.diffNo
			inner join GEMP01MT c
				on b.empID = c.empID
			where
				a.eventYM = #eventYM#
				and a.venueCD in
				<iterate property="venueCDs" open="(" close=")" conjunction=",">
					#venueCDs[]#
		     	</iterate>
		     	and a.diffNo = #diffNo#
		     	and b.apprTpID = #apprTpID#
				and (b.apprStateCD is not null and b.apprStateCD != '20')
				and b.empID != #empID#
		)
		group by empID
	</select>
	
	<!-- Result승인정보 하위자 반려처리 -->
	<update id="RLT0200104U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GRLT07MT
		set
			apprStateCD = #apprStateCD#
			, apprDate = sysdate
			, commt = #apprCommt#
			, chgID = #userID#
			, chgDate = sysdate
		where
			eventYM = #eventYM#
			and venueCD = #venueCD#
			and diffNo = #diffNo#
			and apprTpID = #apprTpID#
			and empID = #empID#
	</update>
	
	<!-- Result승인 엑셀 조회 -->
	<select id="RLT0200105S" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap">
		select
			getLangDesc(#companyID#,#languageCD#,'F_CODE','PROGRAMCD',programCD,null) as "programCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','ACTIVITYCD',activityCD,null) as "activityCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','RAGESPHERECD',rageSphereCD,null) as "rageSphereCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','OFFICECD',officeCD,null) as "officeCDName"
			<isPropertyAvailable property="grpID">
				<isNotEmpty property="grpID">
			, (case when (select dkmdtpcd from GEMP01MT where empID=t.empID) != 'DK' then '' else (select empNm from GEMP01MT where empID=t.empID) end) as "empNm"
				</isNotEmpty>
				<isEmpty property="grpID">
			, (select empNm from GEMP01MT where empID=t.empID) as "empNm"
				</isEmpty>
			</isPropertyAvailable>
			, venueCD as "venueCD"
			, venueNm as "venueNm"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','VENUEGRADCD',venueGradCD,null) as "venueGradCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','SEGMENTCD',segmentCD,null) as "segmentCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','SUBSEGMENTCD',subSegmentCD,null) as "subSegmentCDName"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','ADDRTPCD1',addrTpCD1,null) as "addrTpCD1Name"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','ADDRTPCD2',addrTpCD2,null) as "addrTpCD2Name"
			, tpayAmt as "tpayAmt"
			, resultTQty as "resultTQty"
			, avgUnitAmt as "avgUnitAmt"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','RESULTTPCD',resultTpCD,null) as "resultTpCDName"
			, targetRate as "targetRate"
			, payRate as "payRate"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','EXCPAYTPCD',excPayTpCD,null) as "excPayTpCDName"
			, gsvRate as "gsvRate"
			, commt as "commt"
			, apprCommt as "apprCommt"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','APPRSTATECD',apprStateCD_emp,null) as "apprStateCDName_emp"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','APPRSTATECD',apprStateCD,null) as "apprStateCDName"
			, apprStateCD as "apprStateCD"
			, apprStateCD_emp as "apprStateCD_emp"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','KINDTPCD5',kindTpCD5,null) as "kindTpCD5Name"
			, prdNm as "prdNm"
			, factoryPrice as "factoryPrice"
			, getLangDesc(#companyID#,#languageCD#,'F_CODE','QTYUNITCD',qtyUnitCD,null) as "qtyUnitCDName"
			, planQty as "planQty"
			, resultQty as "resultQty"
			, resultUnitAmt as "resultUnitAmt"
			, payAmt as "payAmt"
		from (
			select
				b.programCD
				, b.activityCD
				, c.rageSphereCD
				, c.officeCD
				, b.empID
				, a.venueCD
				, venueNm
				, venueGradCD
				, segmentCD
				, subSegmentCD
				, addrTpCD1
				, addrTpCD2
				, b.tpayAmt
				, resultTQty
				, (
					case when resultTQty=0 then 0
					else round(b.tpayAmt / resultTQty)
					end
				) as avgUnitAmt
				, resultTpCD
				, targetRate
				, payRate
				, guidPayRate
				, excPayTpCD
				, b.gsvRate
				, b.commt
				, a.commt as apprCommt
				, b.apprStateCD
				, a.apprStateCD as apprStateCD_emp
				, f.kindTpCD5
				, f.prdNm
				, e.factoryPrice
				, f.qtyUnitCD
				, (select planQty from GPLN01DT where eventYM=e.eventYM and venueCD=e.venueCD and prdCD=e.prdCD) as planQty
				, e.resultQty
				, e.resultUnitAmt
				, e.payAmt
				, e.prdCD
				, (
					case when b.lapprLevelNo = a.levelNo then 'Y'
					else 'N'
					end
				) as lastApprYN
				, (
					case when payRate != guidPayRate then 'Y'
					else 'N'
					end
				) as payRate_YN
				, (
					case when excPayTpCD = 'YPAY' then 'Y'
					else 'N'
					end
				) as excPayTpCD_YN
				, (
					case when b.gsvRate > 10 then 'Y'
					else 'N'
					end
				) as gsvRate_YN
			from GRLT07MT a
			inner join GRLT01MT b
				on a.eventYM = b.eventYM
				and a.venueCD = b.venueCD
				and a.diffNo = b.diffNo
			inner join GEMP01MT c
				on b.empID = c.empID
			inner join GVEN01MT d
				on a.venueCD = d.venueCD
			inner join GRLT01DT e
				on a.eventYM = e.eventYM
				and a.venueCD = e.venueCD
				and a.diffNo = e.diffNo
			inner join GPRD01MT f
				on e.prdCD = f.prdCD
			<!-- 
			inner join GPLN01MT g
				on a.eventYM = g.eventYM
				and a.venueCD = g.venueCD
			<isPropertyAvailable property="plnRltCompareYN">
				<isEqual property="plnRltCompareYN" compareValue="Y">
					and b.tpayAmt <![CDATA[<>]]> g.tpayAmt
				</isEqual>
				<isEqual property="plnRltCompareYN" compareValue="N">
					and b.tpayAmt = g.tpayAmt
				</isEqual>
			</isPropertyAvailable>
			-->
			inner join gpln01dt g
			on e.eventYM = g.eventYM
				and e.venueCD = g.venueCD
				and e.prdCD = g.prdCD
			<isPropertyAvailable property="plnRltCompareYN">
				<isEqual property="plnRltCompareYN" compareValue="Y">
					and e.resultUnitAmt*e.resultQty <![CDATA[<>]]> g.planUnitAmt*e.resultQty
				</isEqual>
				<isEqual property="plnRltCompareYN" compareValue="N">
					and e.resultUnitAmt*e.resultQty = g.planUnitAmt*e.resultQty
				</isEqual>
			</isPropertyAvailable>
			<!-- 
			inner join 
				(
					select
						 eventYM
						,venueCD
						,resultUnitAmt
						,planUnitAmt
						,diffNo
						,prdCD
					from
						(select
							 t1.eventYM
							,t1.venueCD
							,t1.resultUnitAmt resultUnitAmt
							,t2.planUnitAmt planUnitAmt
							,t1.diffNo
							,t1.prdCD
						from GRLT01DT t1 INNER JOIN gpln01dt t2
						on t1.eventYM = t2.eventYM
						and t1.venueCD = t2.venueCD
						and t1.prdCD = t2.prdCD
						where
							t1.eventYM = #eventYM#
						)
					<isPropertyAvailable property="plnRltCompareYN">
						<isEqual property="plnRltCompareYN" compareValue="Y">
						where
							resultUnitAmt <![CDATA[<>]]> planUnitAmt
						</isEqual>
						<isEqual property="plnRltCompareYN" compareValue="N">
						where
							resultUnitAmt = planUnitAmt
						</isEqual>
					</isPropertyAvailable>
				) g
				on e.eventYM = g.eventYM
				and e.venueCD = g.venueCD
				and e.diffNo = g.diffNo
				and e.prdCD = g.prdCD
				-->
			where
				a.eventYM = #eventYM#
				and a.empID = #empID#
				and a.diffNo = #diffNo#
				and a.apprTpID = #apprTpID#
				and b.programCD = 'G1'
				and a.apprStateCD in (
					select comCode
					from F_CODE
					where
						codediv='APPRSTATECD'
						and activeFlg = 'U'
						and useYN = 'Y'
						and attrib02 = 'MNG'
				)
				<isPropertyAvailable property="activityCD">
					<isNotEmpty prepend="and" property="activityCD">
						activityCD = #activityCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="venueGradCD">
					<isNotEmpty prepend="and" property="venueGradCD">
						venueGradCD = #venueGradCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="segmentCD">
					<isNotEmpty prepend="and" property="segmentCD">
						segmentCD = #segmentCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="subSegmentCD">
					<isNotEmpty prepend="and" property="subSegmentCD">
						subSegmentCD = #subSegmentCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="rageSphereCD">
					<isNotEmpty prepend="and" property="rageSphereCD">
						c.rageSphereCD = #rageSphereCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD">
					<isNotEmpty prepend="and" property="officeCD">
						c.officeCD = #officeCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="apprStateCD">
					<isNotEmpty prepend="and" property="apprStateCD">
						a.apprStateCD = #apprStateCD#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="dkmdTpCD">
					<isNotEmpty prepend="and" property="dkmdTpCD">
						b.dkmdTpCD = #dkmdTpCD#
					</isNotEmpty>
				</isPropertyAvailable>
		) t
		where 1=1
			<isPropertyAvailable property="payRate_YN">
				<isNotEmpty prepend="and" property="payRate_YN">
					payRate_YN = #payRate_YN#
				</isNotEmpty>
			</isPropertyAvailable>
			<isPropertyAvailable property="excPayTpCD_YN">
				<isNotEmpty prepend="and" property="excPayTpCD_YN">
					excPayTpCD_YN = #excPayTpCD_YN#
				</isNotEmpty>
			</isPropertyAvailable>
			<isPropertyAvailable property="gsvRate_YN">
				<isNotEmpty prepend="and" property="gsvRate_YN">
					gsvRate_YN = #gsvRate_YN#
				</isNotEmpty>
			</isPropertyAvailable>
		order by
			rageSphereCD
			, officeCD
			, empID
			, venueCD
			, prdCD
	</select>

	<select id="RLT0200107S" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap">
		select
		<!-- 
			 DECODE(apprStateCDName,'','',getLangDesc(#companyID#,#languageCD#,'F_CODE','RAGESPHERECD',rageSphereCD,null)) as "rageSphereCDName"
			,DECODE(apprStateCDName,'','',getLangDesc(#companyID#,#languageCD#,'F_CODE','OFFICECD',officeCD,null)) as "officeCDName"
		 --><!--
		 	getLangDesc(#companyID#,#languageCD#,'F_CODE','RAGESPHERECD',rageSphereCD,null) as "rageSphereCDName"
			,getLangDesc(#companyID#,#languageCD#,'F_CODE','OFFICECD',officeCD,null) as "officeCDName"
			-->
			<!-- 
			DECODE(apprStateCDName,'','',DECODE(rageSphereCD,'9999','미지정권역',x1.codename)) as "rageSphereCDName"
			,DECODE(apprStateCDName,'','',DECODE(officeCD,'9999','미지정지점',x2.codename)) as "officeCDName"
			 -->
			 DECODE(rageSphereCD,'9999','미지정권역',x1.codename) as "rageSphereCDName"
			,DECODE(officeCD,'9999','미지정지점',x2.codename) as "officeCDName"
			,type as "type"
			,apprStateCDName as "apprStateCDName"
			,tpayAmt * GETTAXBASE() as "tpayAmt"
			,planTQty as "planTQty"
			,avgUnitAmt as "avgUnitAmt"
			,gsvRate as "gsvRate"
			,apprStateCD as "apprStateCD"
			,monthSeq as "monthSeq"
		from
		(
		select
			nvl(rageSphereCD, '9999') as rageSphereCD,
            nvl(officeCD, '9999') as officeCD,
	        getLangDesc(#companyID#,#languageCD#,'F_CODE','KINDTPCD5',kindTpCD5,null) as type,
	        getLangDesc( #companyID# /**P*/,
	         #languageCD#,
	        'F_CODE',
	        'APPRSTATECD',
	        apprStateCD,
	        null) as apprStateCDName    ,
	        sum(payAmt) as tpayAmt    ,
	        sum(resultQty) as planTQty    ,
	        (       case 
	                    when sum(resultQty)=0 then 0       
	                    else round(sum(payAmt) / sum(resultQty))       
	                end      ) as avgUnitAmt    ,
	        (		case 
	                    when sum(resultQty_factoryPrice)=0 then 0       
	                    else 
	        ((sum(payAmt)*(1+0.0352)) / sum(resultQty_factoryPrice)) * 100 end) as gsvRate,
	        apprStateCD as apprStateCD,
	        kindTpCD5 as kindTpCD5,
	        '1' as orderBySeq,
	        '1' as monthSeq
    	from
        
            (     select
                programCD      ,
                activityCD      ,
                c.rageSphereCD      ,
                c.officeCD      ,
                b.empID      ,
                a.venueCD      ,
                venueNm      ,
                venueGradCD      ,
                segmentCD      ,
                subSegmentCD      ,
                addrTpCD1      ,
                addrTpCD2      ,
                payAmt      ,
                resultQty      ,
                gsvRate      ,
                b.commt      ,
                a.commt as apprCommt      ,
                b.apprStateCD      ,
                f.kindTpCD5  ,
                e.resultQty*e.factoryPrice as resultQty_factoryPrice
            from
                GRLT07MT a     
            inner join
                GRLT01MT b      
                    on a.eventYM = b.eventYM      
                    and a.venueCD = b.venueCD     
            inner join
                GEMP01MT c      
                    on b.empID = c.empID     
            inner join
                GVEN01MT d      
                    on a.venueCD = d.venueCD     
            inner join
                GRLT01DT e      
                    on b.eventYM = e.eventYM      
                    and b.venueCD = e.venueCD
            inner join
                GPRD01MT f     
                    on e.prdCD = f.prdCD
            where
                a.eventYM =  #eventYM#
                and a.empID =  #empID#
                and a.apprTpID = #apprTpID#
                and a.apprStateCD in (
                    select
                        comCode       
                    from
                        F_CODE       
                    where
                        codediv='APPRSTATECD'        
                        and activeFlg = 'U'        
                        and useYN = 'Y'        
                        and attrib02 = 'MNG'      
                )                                                                                                                                                  
                <!-- and a.apprStateCD =  '50' -->
                <isPropertyAvailable property="rageSphereCD_pop">
					<isNotEmpty prepend="and" property="rageSphereCD_pop">
						c.rageSphereCD = #rageSphereCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD_pop">
					<isNotEmpty prepend="and" property="officeCD_pop">
						c.officeCD = #officeCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
            ) t
		group by rageSphereCD, officeCD, kindTpCD5, apprStateCD
		union all
		select
			nvl(rageSphereCD, '9999') as rageSphereCD,
            nvl(officeCD, '9999') as officeCD,
	        DECODE(officeCD,null,'미지정',getLangDesc(#companyID#,#languageCD#,'F_CODE','OFFICECD',officeCD,null))||'지점 합계',
	        '' as "apprStateCDName"    ,
	        sum(payAmt) as "tpayAmt"    ,
	        sum(resultQty) as "planTQty"    ,
	        (       case 
	                    when sum(resultQty)=0 then 0       
	                    else round(sum(payAmt) / sum(resultQty))       
	                end      ) as "avgUnitAmt"    ,
	        (		case 
	                    when sum(resultQty_factoryPrice)=0 then 0       
	                    else 
	        ((sum(payAmt)*(1+0.0352)) / sum(resultQty_factoryPrice)) * 100 end) as "gsvRate",
	        '' as "apprStateCD" ,
	        '' as kindTpCD5,
	        '3' as orderBySeq,
	        '1' as monthSeq
    	from
            (     select
                programCD      ,
                activityCD      ,
                c.rageSphereCD      ,
                c.officeCD      ,
                b.empID      ,
                a.venueCD      ,
                venueNm      ,
                venueGradCD      ,
                segmentCD      ,
                subSegmentCD      ,
                addrTpCD1      ,
                addrTpCD2      ,
                payAmt      ,
                resultQty      ,
                gsvRate      ,
                b.commt      ,
                a.commt as apprCommt      ,
                b.apprStateCD       ,
                e.resultQty*e.factoryPrice as resultQty_factoryPrice  
            from
                GRLT07MT a     
            inner join
                GRLT01MT b      
                    on a.eventYM = b.eventYM      
                    and a.venueCD = b.venueCD     
            inner join
                GEMP01MT c      
                    on b.empID = c.empID     
            inner join
                GVEN01MT d      
                    on a.venueCD = d.venueCD     
            inner join
                GRLT01DT e      
                    on b.eventYM = e.eventYM      
                    and b.venueCD = e.venueCD
            inner join
                GPRD01MT f     
                    on e.prdCD = f.prdCD
            where
                a.eventYM =  #eventYM# 
                and a.empID =  #empID#
                and a.apprTpID = #apprTpID#
                and a.apprStateCD in (
                    select
                        comCode       
                    from
                        F_CODE       
                    where
                        codediv='APPRSTATECD'        
                        and activeFlg = 'U'        
                        and useYN = 'Y'        
                        and attrib02 = 'MNG'      
                )                                                                                                                                                  
                <!-- and        a.apprStateCD =  '50' -->
                <isPropertyAvailable property="rageSphereCD_pop">
					<isNotEmpty prepend="and" property="rageSphereCD_pop">
						c.rageSphereCD = #rageSphereCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD_pop">
					<isNotEmpty prepend="and" property="officeCD_pop">
						c.officeCD = #officeCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
            ) t
            group by rageSphereCD, officeCD
		union all
		select
			nvl(rageSphereCD, '9999') as rageSphereCD,
            nvl(officeCD, '9999') as officeCD,
	        DECODE(officeCD,null,'미지정',getLangDesc(#companyID#,#languageCD#,'F_CODE','OFFICECD',officeCD,null))||'지점 '||substr(max(eventYM),1,4)||'년'||substr(max(eventYM),5,2)||'월(전월) 승인합계',
	        '' as "apprStateCDName"    ,
	        sum(payAmt) as "tpayAmt"    ,
	        sum(resultQty) as "planTQty"    ,
	        (       case 
	                    when sum(resultQty)=0 then 0       
	                    else round(sum(payAmt) / sum(resultQty))       
	                end      ) as "avgUnitAmt"    ,
	        (		case 
	                    when sum(resultQty_factoryPrice)=0 then 0       
	                    else 
	        ((sum(payAmt)*(1+0.0352)) / sum(resultQty_factoryPrice)) * 100 end) as "gsvRate",
	        '' as "apprStateCD" ,
	        '' as kindTpCD5,
        	'4' as orderBySeq,
	        '2' as monthSeq
    	from
        
            (
            select
                programCD      ,
                activityCD      ,
                c.rageSphereCD      ,
                c.officeCD      ,
                b.empID      ,
                a.venueCD      ,
                venueNm      ,
                venueGradCD      ,
                segmentCD      ,
                subSegmentCD      ,
                addrTpCD1      ,
                addrTpCD2      ,
                payAmt      ,
                resultQty      ,
                gsvRate      ,
                b.commt      ,
                a.commt as apprCommt      ,
                b.apprStateCD   ,
                a.eventYM	,
                e.resultQty*e.factoryPrice as resultQty_factoryPrice
            from
                GRLT07MT a     
            inner join
                GRLT01MT b      
                    on a.eventYM = b.eventYM      
                    and a.venueCD = b.venueCD     
            inner join
                GEMP01MT c      
                    on b.empID = c.empID     
            inner join
                GVEN01MT d      
                    on a.venueCD = d.venueCD     
            inner join
                GRLT01DT e      
                    on b.eventYM = e.eventYM      
                    and b.venueCD = e.venueCD
            inner join
                GPRD01MT f     
                    on e.prdCD = f.prdCD
            where
                a.eventYM =  #eventYMBefore#
                and a.empID =  #empID#
                and a.apprTpID = #apprTpID#
                and a.apprStateCD in (
                    select
                        comCode       
                    from
                        F_CODE       
                    where
                        codediv='APPRSTATECD'        
                        and activeFlg = 'U'        
                        and useYN = 'Y'        
                        and attrib02 = 'MNG'      
                )                                                                                                                                                  
                and        a.apprStateCD =  '50'
                <isPropertyAvailable property="rageSphereCD_pop">
					<isNotEmpty prepend="and" property="rageSphereCD_pop">
						c.rageSphereCD = #rageSphereCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD_pop">
					<isNotEmpty prepend="and" property="officeCD_pop">
						c.officeCD = #officeCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
            ) t
            group by rageSphereCD, officeCD
            union all
		select
			nvl(rageSphereCD, '9999') as rageSphereCD,
            '' as officeCD,
	        DECODE(rageSphereCD,null,'미지정 권역',getLangDesc(#companyID#,#languageCD#,'F_CODE','RAGESPHERECD',rageSphereCD,null))||' 합계',
	        '' as "apprStateCDName"    ,
	        sum(payAmt) as "tpayAmt"    ,
	        sum(resultQty) as "planTQty"    ,
	        (       case 
	                    when sum(resultQty)=0 then 0       
	                    else round(sum(payAmt) / sum(resultQty))       
	                end      ) as "avgUnitAmt"    ,
	        (		case 
	                    when sum(resultQty_factoryPrice)=0 then 0       
	                    else 
	        ((sum(payAmt)*(1+0.0352)) / sum(resultQty_factoryPrice)) * 100 end) as "gsvRate",
	        '' as "apprStateCD" ,
	        '' as kindTpCD5,
	        '3' as orderBySeq,
	        '1' as monthSeq
    	from
            (     select
                programCD      ,
                activityCD      ,
                c.rageSphereCD      ,
                c.officeCD      ,
                b.empID      ,
                a.venueCD      ,
                venueNm      ,
                venueGradCD      ,
                segmentCD      ,
                subSegmentCD      ,
                addrTpCD1      ,
                addrTpCD2      ,
                payAmt      ,
                resultQty      ,
                gsvRate      ,
                b.commt      ,
                a.commt as apprCommt      ,
                b.apprStateCD       ,
                e.resultQty*e.factoryPrice as resultQty_factoryPrice  
            from
                GRLT07MT a     
            inner join
                GRLT01MT b      
                    on a.eventYM = b.eventYM      
                    and a.venueCD = b.venueCD     
            inner join
                GEMP01MT c      
                    on b.empID = c.empID     
            inner join
                GVEN01MT d      
                    on a.venueCD = d.venueCD     
            inner join
                GRLT01DT e      
                    on b.eventYM = e.eventYM      
                    and b.venueCD = e.venueCD
            inner join
                GPRD01MT f     
                    on e.prdCD = f.prdCD
            where
                a.eventYM =  #eventYM# 
                and a.empID =  #empID#
                and a.apprTpID = #apprTpID#
                and a.apprStateCD in (
                    select
                        comCode       
                    from
                        F_CODE       
                    where
                        codediv='APPRSTATECD'        
                        and activeFlg = 'U'        
                        and useYN = 'Y'        
                        and attrib02 = 'MNG'      
                )                                                                                                                                                  
                <!-- and        a.apprStateCD =  '50' -->
                <isPropertyAvailable property="rageSphereCD_pop">
					<isNotEmpty prepend="and" property="rageSphereCD_pop">
						c.rageSphereCD = #rageSphereCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD_pop">
					<isNotEmpty prepend="and" property="officeCD_pop">
						c.officeCD = #officeCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
            ) t
            group by rageSphereCD
		union all
		select
			nvl(rageSphereCD, '9999') as rageSphereCD,
            '' as officeCD,
	        DECODE(rageSphereCD,null,'미지정 권역',getLangDesc(#companyID#,#languageCD#,'F_CODE','RAGESPHERECD',rageSphereCD,null))||' '||substr(max(eventYM),1,4)||'년'||substr(max(eventYM),5,2)||'월(전월) 승인합계',
	        '' as "apprStateCDName"    ,
	        sum(payAmt) as "tpayAmt"    ,
	        sum(resultQty) as "planTQty"    ,
	        (       case 
	                    when sum(resultQty)=0 then 0       
	                    else round(sum(payAmt) / sum(resultQty))       
	                end      ) as "avgUnitAmt"    ,
	        (		case 
	                    when sum(resultQty_factoryPrice)=0 then 0       
	                    else 
	        ((sum(payAmt)*(1+0.0352)) / sum(resultQty_factoryPrice)) * 100 end) as "gsvRate",
	        '' as "apprStateCD" ,
	        '' as kindTpCD5,
        	'4' as orderBySeq,
	        '2' as monthSeq
    	from
        
            (
            select
                programCD      ,
                activityCD      ,
                c.rageSphereCD      ,
                c.officeCD      ,
                b.empID      ,
                a.venueCD      ,
                venueNm      ,
                venueGradCD      ,
                segmentCD      ,
                subSegmentCD      ,
                addrTpCD1      ,
                addrTpCD2      ,
                payAmt      ,
                resultQty      ,
                gsvRate      ,
                b.commt      ,
                a.commt as apprCommt      ,
                b.apprStateCD   ,
                a.eventYM	,
                e.resultQty*e.factoryPrice as resultQty_factoryPrice
            from
                GRLT07MT a     
            inner join
                GRLT01MT b      
                    on a.eventYM = b.eventYM      
                    and a.venueCD = b.venueCD     
            inner join
                GEMP01MT c      
                    on b.empID = c.empID     
            inner join
                GVEN01MT d      
                    on a.venueCD = d.venueCD     
            inner join
                GRLT01DT e      
                    on b.eventYM = e.eventYM      
                    and b.venueCD = e.venueCD
            inner join
                GPRD01MT f     
                    on e.prdCD = f.prdCD
            where
                a.eventYM =  #eventYMBefore#
                and a.empID =  #empID#
                and a.apprTpID = #apprTpID#
                and a.apprStateCD in (
                    select
                        comCode       
                    from
                        F_CODE       
                    where
                        codediv='APPRSTATECD'        
                        and activeFlg = 'U'        
                        and useYN = 'Y'        
                        and attrib02 = 'MNG'      
                )                                                                                                                                                  
                and        a.apprStateCD =  '50'
                <isPropertyAvailable property="rageSphereCD_pop">
					<isNotEmpty prepend="and" property="rageSphereCD_pop">
						c.rageSphereCD = #rageSphereCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD_pop">
					<isNotEmpty prepend="and" property="officeCD_pop">
						c.officeCD = #officeCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
            ) t
            group by rageSphereCD
            union all
		select
			'' as rageSphereCD,
			'' as officeCD,
	        '총계',
	        '' as "apprStateCDName"    ,
	        sum(payAmt) as "tpayAmt"    ,
	        sum(resultQty) as "planTQty"    ,
	        (       case 
	                    when sum(resultQty)=0 then 0       
	                    else round(sum(payAmt) / sum(resultQty))       
	                end      ) as "avgUnitAmt"    ,
	        (		case 
	                    when sum(resultQty_factoryPrice)=0 then 0       
	                    else 
	        ((sum(payAmt)*(1+0.0352)) / sum(resultQty_factoryPrice)) * 100 end) as "gsvRate",
	        '' as "apprStateCD" ,
	        '' as kindTpCD5,
	        '3' as orderBySeq,
	        '1' as monthSeq
    	from
            (     select
                programCD      ,
                activityCD      ,
                c.rageSphereCD      ,
                c.officeCD      ,
                b.empID      ,
                a.venueCD      ,
                venueNm      ,
                venueGradCD      ,
                segmentCD      ,
                subSegmentCD      ,
                addrTpCD1      ,
                addrTpCD2      ,
                payAmt      ,
                resultQty      ,
                gsvRate      ,
                b.commt      ,
                a.commt as apprCommt      ,
                b.apprStateCD       ,
                e.resultQty*e.factoryPrice as resultQty_factoryPrice  
            from
                GRLT07MT a     
            inner join
                GRLT01MT b      
                    on a.eventYM = b.eventYM      
                    and a.venueCD = b.venueCD     
            inner join
                GEMP01MT c      
                    on b.empID = c.empID     
            inner join
                GVEN01MT d      
                    on a.venueCD = d.venueCD     
            inner join
                GRLT01DT e      
                    on b.eventYM = e.eventYM      
                    and b.venueCD = e.venueCD
            inner join
                GPRD01MT f     
                    on e.prdCD = f.prdCD
            where
                a.eventYM =  #eventYM# 
                and a.empID =  #empID#
                and a.apprTpID = #apprTpID#
                and a.apprStateCD in (
                    select
                        comCode       
                    from
                        F_CODE       
                    where
                        codediv='APPRSTATECD'        
                        and activeFlg = 'U'        
                        and useYN = 'Y'        
                        and attrib02 = 'MNG'      
                )
                <isPropertyAvailable property="rageSphereCD_pop">
					<isNotEmpty prepend="and" property="rageSphereCD_pop">
						c.rageSphereCD = #rageSphereCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD_pop">
					<isNotEmpty prepend="and" property="officeCD_pop">
						c.officeCD = #officeCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>                                                                                                                                                
                <!-- and        a.apprStateCD =  '50' -->
            ) t
		union all
		select
			'' as rageSphereCD,
			'' as officeCD,
	        substr(max(eventYM),1,4)||'년'||substr(max(eventYM),5,2)||'월(전월) 총 승인합계',
	        '' as "apprStateCDName"    ,
	        sum(payAmt) as "tpayAmt"    ,
	        sum(resultQty) as "planTQty"    ,
	        (       case 
	                    when sum(resultQty)=0 then 0       
	                    else round(sum(payAmt) / sum(resultQty))       
	                end      ) as "avgUnitAmt"    ,
	        (		case 
	                    when sum(resultQty_factoryPrice)=0 then 0       
	                    else 
	        ((sum(payAmt)*(1+0.0352)) / sum(resultQty_factoryPrice)) * 100 end) as "gsvRate",
	        '' as "apprStateCD" ,
	        '' as kindTpCD5,
        	'4' as orderBySeq,
	        '2' as monthSeq
    	from
        
            (
            select
                programCD      ,
                activityCD      ,
                c.rageSphereCD      ,
                c.officeCD      ,
                b.empID      ,
                a.venueCD      ,
                venueNm      ,
                venueGradCD      ,
                segmentCD      ,
                subSegmentCD      ,
                addrTpCD1      ,
                addrTpCD2      ,
                payAmt      ,
                resultQty      ,
                gsvRate      ,
                b.commt      ,
                a.commt as apprCommt      ,
                b.apprStateCD   ,
                a.eventYM	,
                e.resultQty*e.factoryPrice as resultQty_factoryPrice
            from
                GRLT07MT a     
            inner join
                GRLT01MT b      
                    on a.eventYM = b.eventYM      
                    and a.venueCD = b.venueCD     
            inner join
                GEMP01MT c      
                    on b.empID = c.empID     
            inner join
                GVEN01MT d      
                    on a.venueCD = d.venueCD     
            inner join
                GRLT01DT e      
                    on b.eventYM = e.eventYM      
                    and b.venueCD = e.venueCD
            inner join
                GPRD01MT f     
                    on e.prdCD = f.prdCD
            where
                a.eventYM =  #eventYMBefore#
                and a.empID =  #empID#
                and a.apprTpID = #apprTpID#
                and a.apprStateCD in (
                    select
                        comCode       
                    from
                        F_CODE       
                    where
                        codediv='APPRSTATECD'        
                        and activeFlg = 'U'        
                        and useYN = 'Y'        
                        and attrib02 = 'MNG'      
                )                                                                                                                                                  
                and        a.apprStateCD =  '50'
                <isPropertyAvailable property="rageSphereCD_pop">
					<isNotEmpty prepend="and" property="rageSphereCD_pop">
						c.rageSphereCD = #rageSphereCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
				<isPropertyAvailable property="officeCD_pop">
					<isNotEmpty prepend="and" property="officeCD_pop">
						c.officeCD = #officeCD_pop#
					</isNotEmpty>
				</isPropertyAvailable>
            ) t
        ) x
        left outer join f_code x1
        on x.rageSphereCD = x1.comcode
        and x1.codediv = 'RAGESPHERECD'
        left outer join f_code x2
        on x.officeCD = x2.comcode
        and x2.codediv = 'OFFICECD'
        order by monthSeq,rageSphereCD, officeCD, orderBySeq, kindTpCD5, apprStateCD
	</select>
		
	<!-- reslt 정보 승인상태 갱신 -->
	<update id="RLT0200105U" parameterClass="com.kia.rlt.model.GRLT01MT">
		 update GRLT01MT
			set	apprStateCD = #apprStateCD#
			  , chgID       = #userID#
			  , chgDate     = sysdate
	      where eventYM     = #eventYM#
	       and diffno = #diffNo#
	      <isPropertyAvailable property="apprLv">
	      	<isNotEmpty property="apprLv">
	      		<isEqual property="apprLv" compareValue="20">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
										    and empid in ( select empID  from GAPP01DT
														    where apprTpID =  '000000' 
															  and papprGrpID in (  select apprgrpid
																			         from gapp01dt 
																			        where apprTpID = '000000' 
																			          and empid    = #userID#
																				)  
											              )
			                           ) 
	             </isEqual>
	             <isEqual property="apprLv" compareValue="30">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
										    and empid in ( 
										    			SELECT EMPID
														FROM GAPP01DT
														WHERE APPRTPID      =  '000000'  
														AND PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE EMPID = #userID#
																AND APPRTPID      =  '000000' 
															)
														)
												)
			                           ) 
	             </isEqual>
				<isEqual property="apprLv" compareValue="40">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
										    and empid in ( 
										    			SELECT EMPID
														FROM GAPP01DT
														WHERE PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE APPRTPID      =  '000000'  
																AND PAPPRGRPID IN (
																	SELECT APPRGRPID
																	FROM GAPP01DT
																	WHERE EMPID = #userID#
																	AND APPRTPID      =  '000000' 
																)
															)
														)
												)
			                           ) 
	             </isEqual>
			</isNotEmpty>
			<isEmpty property="apprLv">
				and venueCD = ''
			</isEmpty>
		</isPropertyAvailable>
		<isNotPropertyAvailable property="apprLv">
			and venueCD = ''
		</isNotPropertyAvailable>
	</update>
	
	<!-- Result 승인정보 승인처리 -->
	<update id="RLT0200106U" parameterClass="com.kia.rlt.model.GRLT01MT">
		 update GRLT07MT
			set	apprStateCD = '50'
			  , commt    = #apprCommt#
			  , apprDate = sysdate
			  , chgID    = #userID#
			  , chgDate  = sysdate
		  where	eventYM  = #eventYM#		
			and levelNo  = #levelNo#
			and diffno = #diffNo#
		  <isPropertyAvailable property="apprLv">
			<isNotEmpty property="apprLv">
				<isEqual property="apprLv" compareValue="20">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( select empID  from GAPP01DT
															where apprTpID =  '000000' 
															  and papprGrpID in (  select apprgrpid
																					 from gapp01dt 
																					where apprTpID = '000000' 
																					  and empid    = #userID#
																				)  
														  )
									   ) 
				 </isEqual>
				 <isEqual property="apprLv" compareValue="30">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE APPRTPID      =  '000000'  
														AND PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE EMPID = #userID#
																AND APPRTPID      =  '000000' 
															)
														)
												)
									   ) 
				 </isEqual>
				<isEqual property="apprLv" compareValue="40">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE APPRTPID      =  '000000'  
																AND PAPPRGRPID IN (
																	SELECT APPRGRPID
																	FROM GAPP01DT
																	WHERE EMPID = #userID#
																	AND APPRTPID      =  '000000' 
																)
															)
														)
												)
									   ) 
				 </isEqual>
			</isNotEmpty>
			<isEmpty property="apprLv">
				and venueCD = ''
			</isEmpty>
		</isPropertyAvailable>
		<isNotPropertyAvailable property="apprLv">
			and venueCD = ''
		</isNotPropertyAvailable>
	</update>
	
	<!-- RSULT 승인정보 상위자 승인요청처리 -->
	<update id="RLT0200107U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GRLT07MT
		   set apprStateCD = '20'
			 , chgID   = #userID#
			 , chgDate = sysdate
		 where eventYM = #eventYM#		  
		  and levelNo  = #levelNo#+1
		  and diffno = #diffNo#
		  <isPropertyAvailable property="apprLv">
			<isNotEmpty property="apprLv">
				<isEqual property="apprLv" compareValue="20">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( select empID  from GAPP01DT
															where apprTpID =  '000000' 
															  and papprGrpID in (  select apprgrpid
																					 from gapp01dt 
																					where apprTpID = '000000' 
																					  and empid    = #userID#
																				)  
														  )
									   ) 
				 </isEqual>
				 <isEqual property="apprLv" compareValue="30">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE APPRTPID      =  '000000'  
														AND PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE EMPID = #userID#
																AND APPRTPID      =  '000000' 
															)
														)
												)
									   ) 
				 </isEqual>
				<isEqual property="apprLv" compareValue="40">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE APPRTPID      =  '000000'  
																AND PAPPRGRPID IN (
																	SELECT APPRGRPID
																	FROM GAPP01DT
																	WHERE EMPID = #userID#
																	AND APPRTPID      =  '000000' 
																)
															)
														)
												)
									   ) 
				 </isEqual>
			</isNotEmpty>
			<isEmpty property="apprLv">
				and venueCD = ''
			</isEmpty>
		</isPropertyAvailable>
		<isNotPropertyAvailable property="apprLv">
			and venueCD = ''
		</isNotPropertyAvailable>
	</update>
	
	<!-- RESULT 승인정보 승인처리 -->
	<update id="RLT0200108U" parameterClass="com.kia.rlt.model.GRLT01MT">
		 update GRLT07MT
			set	apprStateCD = '50'
			  , commt    = #apprCommt#
			  , apprDate = sysdate
			  , chgID    = #userID#
			  , chgDate  = sysdate
		  where	eventYM  = #eventYM#		
			and levelNo  = #levelNo#
			and diffno = #diffNo#
		  <isPropertyAvailable property="apprLv">
			<isNotEmpty property="apprLv">
				<isEqual property="apprLv" compareValue="20">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( select empID  from GAPP01DT
															where apprTpID =  '000000' 
															  and papprGrpID in (  select apprgrpid
																					 from gapp01dt 
																					where apprTpID = '000000' 
																					  and empid    = #userID#
																				)  
														  )
									   ) 
				 </isEqual>
				 <isEqual property="apprLv" compareValue="30">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE APPRTPID      =  '000000'  
														AND PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE EMPID = #userID#
																AND APPRTPID      =  '000000' 
															)
														)
												)
									   ) 
				 </isEqual>
				<isEqual property="apprLv" compareValue="40">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE APPRTPID      =  '000000'  
																AND PAPPRGRPID IN (
																	SELECT APPRGRPID
																	FROM GAPP01DT
																	WHERE EMPID = #userID#
																	AND APPRTPID      =  '000000' 
																)
															)
														)
												)
									   ) 
				 </isEqual>
			</isNotEmpty>
			<isEmpty property="apprLv">
				and venueCD = ''
			</isEmpty>
		</isPropertyAvailable>
		<isNotPropertyAvailable property="apprLv">
			and venueCD = ''
		</isNotPropertyAvailable>
	</update>
	
	<!-- RESULT 승인정보 상위자 승인요청처리 -->
	<update id="RLT0200109U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GRLT07MT
		   set apprStateCD = '20'
			 , chgID   = #userID#
			 , chgDate = sysdate
		 where eventYM = #eventYM#		  
		  and levelNo  = #levelNo#+1
		  and diffno = #diffNo#
		  <isPropertyAvailable property="apprLv">
			<isNotEmpty property="apprLv">
				<isEqual property="apprLv" compareValue="20">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( select empID  from GAPP01DT
															where apprTpID =  '000000' 
															  and papprGrpID in (  select apprgrpid
																					 from gapp01dt 
																					where apprTpID = '000000' 
																					  and empid    = #userID#
																				)  
														  )
									   ) 
				 </isEqual>
				 <isEqual property="apprLv" compareValue="30">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE APPRTPID      =  '000000'  
														AND PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE EMPID = #userID#
																AND APPRTPID      =  '000000' 
															)
														)
												)
									   ) 
				 </isEqual>
				<isEqual property="apprLv" compareValue="40">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE APPRTPID      =  '000000'  
																AND PAPPRGRPID IN (
																	SELECT APPRGRPID
																	FROM GAPP01DT
																	WHERE EMPID = #userID#
																	AND APPRTPID      =  '000000' 
																)
															)
														)
												)
									   ) 
				 </isEqual>
			</isNotEmpty>
			<isEmpty property="apprLv">
				and venueCD = ''
			</isEmpty>
		</isPropertyAvailable>
		<isNotPropertyAvailable property="apprLv">
			and venueCD = ''
		</isNotPropertyAvailable>
	</update>
	
	<!-- reult정보 승인상태 갱신 -->
	<update id="RLT0200110U" parameterClass="com.kia.rlt.model.GRLT01MT">
		 update GRLT01MT
			set	apprStateCD = #apprStateCD#
			  , chgID       = #userID#
			  , chgDate     = sysdate
	      where eventYM     = #eventYM#
	       and diffno = #diffNo#
	      <isPropertyAvailable property="apprLv">
	      	<isNotEmpty property="apprLv">
	      		<isEqual property="apprLv" compareValue="20">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
										    and empid in ( select empID  from GAPP01DT
														    where apprTpID =  '000000' 
															  and papprGrpID in (  select apprgrpid
																			         from gapp01dt 
																			        where apprTpID = '000000' 
																			          and empid    = #userID#
																				)  
											              )
			                           ) 
	             </isEqual>
	             <isEqual property="apprLv" compareValue="30">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
										    and empid in ( 
										    			SELECT EMPID
														FROM GAPP01DT
														WHERE APPRTPID      =  '000000'  
														AND PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE EMPID = #userID#
																AND APPRTPID      =  '000000' 
															)
														)
												)
			                           ) 
	             </isEqual>
				<isEqual property="apprLv" compareValue="40">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
										    and empid in ( 
										    			SELECT EMPID
														FROM GAPP01DT
														WHERE PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE APPRTPID      =  '000000'  
																AND PAPPRGRPID IN (
																	SELECT APPRGRPID
																	FROM GAPP01DT
																	WHERE EMPID = #userID#
																	AND APPRTPID      =  '000000' 
																)
															)
														)
												)
			                           ) 
	             </isEqual>
			</isNotEmpty>
			<isEmpty property="apprLv">
				and venueCD = ''
			</isEmpty>
		</isPropertyAvailable>
		<isNotPropertyAvailable property="apprLv">
			and venueCD = ''
		</isNotPropertyAvailable>
	</update>
	
	
	<!-- reult승인정보 승인처리 -->
	<update id="RLT0200111U" parameterClass="com.kia.rlt.model.GRLT01MT">
		 update GRLT07MT
			set	apprStateCD = '50'
			  , commt    = #apprCommt#
			  , apprDate = sysdate
			  , chgID    = #userID#
			  , chgDate  = sysdate
		  where	eventYM  = #eventYM#		
			and levelNo  = #levelNo#
			and diffno = #diffNo#
		  <isPropertyAvailable property="apprLv">
			<isNotEmpty property="apprLv">
				<isEqual property="apprLv" compareValue="20">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( select empID  from GAPP01DT
															where apprTpID =  '000000' 
															  and papprGrpID in (  select apprgrpid
																					 from gapp01dt 
																					where apprTpID = '000000' 
																					  and empid    = #userID#
																				)  
														  )
									   ) 
				 </isEqual>
				 <isEqual property="apprLv" compareValue="30">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE APPRTPID      =  '000000'  
														AND PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE EMPID = #userID#
																AND APPRTPID      =  '000000' 
															)
														)
												)
									   ) 
				 </isEqual>
				<isEqual property="apprLv" compareValue="40">
					and venueCD     in ( select venueCD from GRLT01MT
										  where eventym = #eventYM#
											and empid in ( 
														SELECT EMPID
														FROM GAPP01DT
														WHERE PAPPRGRPID IN (
															SELECT APPRGRPID
															FROM GAPP01DT
															WHERE APPRTPID      =  '000000'  
															AND PAPPRGRPID IN (
																SELECT APPRGRPID
																FROM GAPP01DT
																WHERE APPRTPID      =  '000000'  
																AND PAPPRGRPID IN (
																	SELECT APPRGRPID
																	FROM GAPP01DT
																	WHERE EMPID = #userID#
																	AND APPRTPID      =  '000000' 
																)
															)
														)
												)
									   ) 
				 </isEqual>
			</isNotEmpty>
			<isEmpty property="apprLv">
				and venueCD = ''
			</isEmpty>
		</isPropertyAvailable>
		<isNotPropertyAvailable property="apprLv">
			and venueCD = ''
		</isNotPropertyAvailable>
	</update>
	
	<!-- 반려시 메일보낼 하위승인자들 정보(상태가 비어있거나, 승인요청인 사람 제외) -->
	<select id="RLT0200108S" parameterClass="com.kia.rlt.model.GRLT01MT" resultClass="java.util.LinkedHashMap">
		select
               empID as "empID"
			 , max(empNm) as "empNm"
			 , max(emailAddr) as "emailAddr"
		from (
			  select b.empID
				   , empNm
				   , emailAddr
				   , b.apprStateCD
			    from GRLT01MT a
			   inner join GRLT07MT b
				  on a.eventYM = b.eventYM
				 and a.venueCD = b.venueCD
			   inner join GEMP01MT c
				  on b.empID = c.empID
			   where a.eventYM = #eventYM#
				 and a.venueCD in
				     (select venueCD from GRLT07MT
                       where eventym = #eventYM#
                         and empid   = #empID#  )
				and (b.apprStateCD is not null and b.apprStateCD != '20')
		)
		group by empID
	</select>
	
	<!-- result정보 승인상태 반려로 갱신 -->
	<update id="RLT0200112U" parameterClass="com.kia.rlt.model.GRLT01MT">
		 update GRLT01MT
			set	apprStateCD = #apprStateCD#
			  , chgID       = #userID#
			  , chgDate     = sysdate
	      where eventYM     = #eventYM#
	       and empid = #empID#
	       and diffno = #diffNo#
	</update>
	
	
	<!-- result승인정보 하위자 반려처리 -->
	<update id="RLT0200113U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GRLT07MT
		   set apprStateCD = #apprStateCD#
			 , apprDate    = sysdate
			 , commt       = #apprCommt#
			 , chgID       = #userID#
			 , chgDate     = sysdate
	    where  eventYM     = #eventYM#		 
		  and  empID       = #empID#
		  and diffno = #diffNo#
		  
	</update>
	
	<!-- 중기약정지급금액 갱신 -->
	<update id="RLT0200114U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GLTC01MT a
		set
			tpayAmt = (
			select 
			nvl(sum(incentive),0)
			from GRLT06MT
			where
			eventYM = #eventYM#
			and venueCD = #venueCD# 
			)
			, chgID = a.empID
			, chgDate = sysdate
		where
			contractDateTo = #eventYM#
			and venueCD = #venueCD#
	</update>
	
	<!-- 중기약정상태값 갱신 -->
	<update id="RLT0200115U" parameterClass="com.kia.rlt.model.GRLT01MT">
		update GLTC01MT a
		set
			a.apprStateCD = decode(a.apprStateCD,'50',decode(a.tpayAmt,0,'70','80'),a.apprStateCD)
			, a.chgID = a.empID
			, a.chgDate = sysdate
		where
			a.contractDateTo = #eventYM#
			and a.venueCD = #venueCD#
	</update>
</sqlMap>